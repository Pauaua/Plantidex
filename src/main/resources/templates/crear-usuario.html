<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTRL - Nuevo Usuario</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="logo">
                <h1>CTRL<span>Forestaci贸n</span></h1>
            </div>
            <ul class="nav-links">
                <li><a th:href="@{/}">Dashboard</a></li>
                <li><a th:href="@{/usuarios/nuevo}" class="btn btn-primary">Nuevo Usuario</a></li>
                <li><a th:href="@{/logout}">Cerrar Sesi贸n</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="form-container">
            <h2 class="form-title">Crear Nuevo Usuario</h2>
            
            <form th:action="@{/usuarios/guardar}" method="post" onsubmit="return validarUsuario()">
                <!-- Informaci贸n Personal -->
                <div class="form-group">
                    <label class="form-label" for="nombre">Nombre Completo *</label>
                    <input type="text" id="nombre" name="nombre" class="form-control" 
                           required minlength="3" maxlength="100"
                           placeholder="Ej: Mar铆a Rodr铆guez Garc铆a">
                    <div class="error" id="nombre-error"></div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="email">Correo Electr贸nico *</label>
                    <input type="email" id="email" name="email" class="form-control" 
                           required placeholder="usuario@ctrl.org">
                    <div class="error" id="email-error"></div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="telefono">Tel茅fono</label>
                    <input type="tel" id="telefono" name="telefono" class="form-control" 
                           pattern="[0-9]{8,12}" placeholder="Ej: 88888888">
                    <div class="error" id="telefono-error"></div>
                </div>

                <!-- Informaci贸n Laboral -->
                <div class="form-group">
                    <label class="form-label" for="rol">Rol en la Organizaci贸n *</label>
                    <select id="rol" name="rol" class="form-control" required>
                        <option value="">Seleccione un rol</option>
                        <option value="ADMIN">Administrador</option>
                        <option value="USER">Usuario</option>
                    </select>
                    <div class="error" id="rol-error"></div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="departamento">Departamento *</label>
                    <select id="departamento" name="departamento" class="form-control" required>
                        <option value="">Seleccione un departamento</option>
                        <option value="reforestacion">Reforestaci贸n</option>
                        <option value="suelos">Regeneraci贸n de Suelos</option>
                        <option value="biodiversidad">Biodiversidad</option>
                        <option value="investigacion">Investigaci贸n</option>
                        <option value="comunicacion">Comunicaci贸n</option>
                    </select>
                    <div class="error" id="departamento-error"></div>
                </div>

                <!-- Estado del Usuario -->
                <div class="form-group">
                    <label class="form-label" for="estado">Estado del Usuario *</label>
                    <select id="estado" name="estado" class="form-control" required>
                        <option value="">Seleccione un estado</option>
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                        <option value="vacaciones">Vacaciones</option>
                        <option value="capacitacion">En Capacitaci贸n</option>
                    </select>
                    <div class="error" id="estado-error"></div>
                </div>

                <!-- Contrase帽a Temporal -->
                <div class="form-group">
                    <label class="form-label" for="password">Contrase帽a Temporal *</label>
                    <input type="password" id="password" name="password" class="form-control" 
                           required minlength="6" placeholder="M铆nimo 6 caracteres">
                    <div class="error" id="password-error"></div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="confirmPassword">Confirmar Contrase帽a *</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" 
                           required placeholder="Repite la contrase帽a">
                    <div class="error" id="confirmPassword-error"></div>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                         Crear Usuario
                    </button>
                    <a th:href="@{/}" class="btn btn-outline" style="text-decoration: none; flex: 1; text-align: center;">
                        ╋ Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <script>
        function validarUsuario() {
            const nombre = document.getElementById('nombre');
            const email = document.getElementById('email');
            const rol = document.getElementById('rol');
            const departamento = document.getElementById('departamento');
            const estado = document.getElementById('estado');
            const password = document.getElementById('password');
            const confirmPassword = document.getElementById('confirmPassword');
            let isValid = true;

            // Limpiar errores anteriores
            document.querySelectorAll('.error').forEach(error => error.textContent = '');

            // Validar nombre
            if (!nombre.value.trim()) {
                document.getElementById('nombre-error').textContent = 'El nombre es requerido';
                isValid = false;
            } else if (nombre.value.length < 3) {
                document.getElementById('nombre-error').textContent = 'El nombre debe tener al menos 3 caracteres';
                isValid = false;
            }

            // Validar email
            if (!email.value.trim()) {
                document.getElementById('email-error').textContent = 'El correo electr贸nico es requerido';
                isValid = false;
            } else if (!/\S+@\S+\.\S+/.test(email.value)) {
                document.getElementById('email-error').textContent = 'Formato de correo inv谩lido';
                isValid = false;
            }

            // Validar rol
            if (!rol.value) {
                document.getElementById('rol-error').textContent = 'El rol es requerido';
                isValid = false;
            }

            // Validar departamento
            if (!departamento.value) {
                document.getElementById('departamento-error').textContent = 'El departamento es requerido';
                isValid = false;
            }

            // Validar estado
            if (!estado.value) {
                document.getElementById('estado-error').textContent = 'El estado es requerido';
                isValid = false;
            }

            // Validar contrase帽a
            if (!password.value) {
                document.getElementById('password-error').textContent = 'La contrase帽a es requerida';
                isValid = false;
            } else if (password.value.length < 6) {
                document.getElementById('password-error').textContent = 'La contrase帽a debe tener al menos 6 caracteres';
                isValid = false;
            }

            // Validar confirmaci贸n de contrase帽a
            if (!confirmPassword.value) {
                document.getElementById('confirmPassword-error').textContent = 'Debes confirmar la contrase帽a';
                isValid = false;
            } else if (password.value !== confirmPassword.value) {
                document.getElementById('confirmPassword-error').textContent = 'Las contrase帽as no coinciden';
                isValid = false;
            }

            return isValid;
        }

        // Validaci贸n en tiempo real para confirmar contrase帽a
        document.getElementById('confirmPassword')?.addEventListener('blur', function() {
            const password = document.getElementById('password');
            const confirmPassword = this;
            const errorElement = document.getElementById('confirmPassword-error');
            
            if (password.value !== confirmPassword.value) {
                errorElement.textContent = 'Las contrase帽as no coinciden';
            } else {
                errorElement.textContent = '';
            }
        });
    </script>
</body>
</html>