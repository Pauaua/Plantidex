<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTRL - Registro de Usuario</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="logo">
                <h1>CTRL</h1>
            </div>
            <ul class="nav-links">
                <li><a th:href="@{/login}">Iniciar Sesión</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="form-container">
            <h2 style="text-align: center; margin-bottom: 2rem; color: var(--color-verde-claro);">
                Crear Cuenta
            </h2>
            
            <form th:action="@{/registro}" method="post" onsubmit="return validarRegistro()">
                <div class="form-group">
                    <label class="form-label" for="nombre">Nombre Completo</label>
                    <input type="text" id="nombre" name="nombre" class="form-control" 
                           required minlength="3" placeholder="Ingresa tu nombre completo">
                    <div class="error" id="nombre-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="email">Correo Electrónico</label>
                    <input type="email" id="email" name="email" class="form-control" 
                           required placeholder="usuario@ejemplo.com">
                    <div class="error" id="email-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="telefono">Teléfono</label>
                    <input type="tel" id="telefono" name="telefono" class="form-control" 
                           pattern="[0-9]{9}" placeholder="Ingresa 9 dígitos">
                    <div class="error" id="telefono-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="sector">Sector *</label>
                    <select id="sector" name="departamento" class="form-control" required>
                        <option value="">Seleccione un sector</option>
                        <option value="REFORESTACION">Reforestación</option>
                        <option value="SUELOS">Suelos</option>
                        <option value="BIODIVERSIDAD">Biodiversidad</option>
                    </select>
                    <div class="error" id="sector-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="rol">Rol</label>
                    <select id="rol" name="rol" class="form-control" required>
                        <option value="USER">Usuario</option>
                        <option value="ADMIN">Administrador</option>
                    </select>
                    <div class="error" id="rol-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="password">Contraseña</label>
                    <input type="password" id="password" name="password" class="form-control" 
                           required minlength="6" placeholder="Mínimo 6 caracteres">
                    <div class="error" id="password-error"></div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="confirmPassword">Confirmar Contraseña</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" 
                           required placeholder="Repite tu contraseña">
                    <div class="error" id="confirmPassword-error"></div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                    Registrarse
                </button>
                <div style="text-align: center;">
                    <a th:href="@{/login}" class="btn btn-outline" style="text-decoration: none;">
                        ¿Ya tienes cuenta? Inicia Sesión
                    </a>
                </div>
            </form>
        </div>
    </div>

    <script>
        function validarRegistro() {
            const nombre = document.getElementById('nombre');
            const email = document.getElementById('email');
            const password = document.getElementById('password');
            const confirmPassword = document.getElementById('confirmPassword');
            let isValid = true;

            // Limpiar errores anteriores
            document.querySelectorAll('.error').forEach(error => error.textContent = '');

            // Validar nombre
            if (!nombre.value) {
                document.getElementById('nombre-error').textContent = 'El nombre es requerido';
                isValid = false;
            } else if (nombre.value.length < 3) {
                document.getElementById('nombre-error').textContent = 'El nombre debe tener al menos 3 caracteres';
                isValid = false;
            }

            // Validar email
            if (!email.value) {
                document.getElementById('email-error').textContent = 'El correo electrónico es requerido';
                isValid = false;
            } else if (!/\S+@\S+\.\S+/.test(email.value)) {
                document.getElementById('email-error').textContent = 'Formato de correo inválido';
                isValid = false;
            }

            // Validar contraseña
            if (!password.value) {
                document.getElementById('password-error').textContent = 'La contraseña es requerida';
                isValid = false;
            } else if (password.value.length < 6) {
                document.getElementById('password-error').textContent = 'La contraseña debe tener al menos 6 caracteres';
                isValid = false;
            }

            // Validar confirmación de contraseña
            if (!confirmPassword.value) {
                document.getElementById('confirmPassword-error').textContent = 'Debes confirmar tu contraseña';
                isValid = false;
            } else if (password.value !== confirmPassword.value) {
                document.getElementById('confirmPassword-error').textContent = 'Las contraseñas no coinciden';
                isValid = false;
            }

            return isValid;
        }

        // Validación en tiempo real para confirmar contraseña
        document.getElementById('confirmPassword')?.addEventListener('blur', function() {
            const password = document.getElementById('password');
            const confirmPassword = this;
            const errorElement = document.getElementById('confirmPassword-error');
            
            if (password.value !== confirmPassword.value) {
                errorElement.textContent = 'Las contraseñas no coinciden';
            } else {
                errorElement.textContent = '';
            }
        });
    </script>
</body>
</html>